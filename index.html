<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Renewable Energy Classifier</title>
    <style>
      :root{color-scheme:light;font-family:"Segoe UI",system-ui,sans-serif;}
      body{margin:0;background:#f3f6ff;color:#1a2b4a;}
      main{max-width:920px;margin:clamp(2rem,9vh,5rem) auto;padding:2.4rem 2.3rem;background:#fff;border-radius:1.1rem;box-shadow:0 18px 38px -28px rgba(20,46,90,.38);}
      h1{margin:0 0 .8rem;text-align:center;font-size:clamp(1.9rem,2vw+1.4rem,2.4rem);}
      p.lead{margin:0 0 2rem;line-height:1.6;text-align:center;color:#425778;}
      .io-grid{display:grid;gap:1.8rem;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));}
      .card{padding:1.4rem;border-radius:1rem;background:#f6f8ff;border:1px solid #d9e3ff;display:flex;flex-direction:column;gap:1.1rem;min-height:360px;}
      label{font-weight:600;}
      .file-input-wrapper{position:relative;}
      input[type="file"]{width:100%;padding:.9rem;border:1px dashed #b9c8f2;border-radius:.9rem;background:#fff;cursor:pointer;}
      input[type="file"]::file-selector-button{margin-right:.8rem;padding:.55rem 1rem;border:none;border-radius:.7rem;background:#2d7be4;color:#fff;font-weight:600;cursor:pointer;}
      .inline-filename{font-size:.95rem;color:#1f2d45;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:absolute;left:8.2rem;right:1rem;top:50%;transform:translateY(-50%);pointer-events:none;}
      .file-meta{margin-top:.35rem;font-size:.9rem;color:#55627e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
      input[type="file"]::file-selector-button{margin-right:.8rem;padding:.55rem 1rem;border:none;border-radius:.7rem;background:#2d7be4;color:#fff;font-weight:600;cursor:pointer;}
      .file-meta{margin-top:.35rem;font-size:.9rem;color:#55627e;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
      button{width:100%;margin-top:.5rem;padding:.9rem;border:none;border-radius:.9rem;font-size:1rem;font-weight:600;color:#fff;background:linear-gradient(135deg,#2d7be4,#1db9de);cursor:pointer;transition:transform .15s ease,box-shadow .15s ease;}
      button:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 16px 24px -18px rgba(33,130,211,.7);}
      button:disabled{opacity:.6;cursor:wait;}
      .preview-shell{flex:1;display:flex;align-items:center;justify-content:center;background:#e8eeff;border-radius:.9rem;position:relative;overflow:hidden;}
      #preview-img{max-width:100%;max-height:100%;display:none;}
      .preview-shell span{color:#5a6b8a;font-size:.95rem;text-align:center;padding:0 1rem;}
      #status{padding:.75rem .9rem;border-radius:.75rem;background:#fff;color:#3b4c6f;border:1px solid #d9e3ff;font-weight:500;}
      .predictions{display:flex;flex-direction:column;gap:.8rem;}
      .prediction-row{display:grid;grid-template-columns:140px 1fr;gap:.8rem;align-items:center;}
      .prediction-row span{font-weight:600;text-transform:capitalize;}
      .bar{position:relative;height:.85rem;border-radius:.85rem;background:#dbe6ff;overflow:hidden;}
      .bar::after{content:"";position:absolute;left:0;top:0;height:100%;width:var(--fill,0%);background:linear-gradient(135deg,#1f82ff,#1dc7c1);}
      .bar-value{font-family:"SFMono-Regular",Consolas,monospace;font-size:.9rem;color:#223356;}
      footer{margin-top:2.2rem;font-size:.85rem;text-align:center;color:#526180;}
      code{background:#e7edff;padding:.1rem .35rem;border-radius:.45rem;}
      a{color:inherit;font-weight:600;}
    </style>
  </head>
  <body>
    <main>
      <h1>Renewable Energy Classifier</h1>
      <p class="lead">Showcase the model in action: upload a photo of solar panels, wind turbines, or a hydroelectric dam and review the predicted confidence scores instantly.</p>
      <div class="io-grid">
        <section class="card" aria-label="Image upload">
          <div>
            <label for="image-input">Step 1 Â· Choose a JPG or PNG image</label>
            <div class="file-input-wrapper">
              <input id="image-input" type="file" accept="image/jpeg,image/png" />
              <span class="inline-filename" id="inline-filename">No file selected</span>
            </div>
            <div class="file-meta" id="file-meta">No file selected</div>
            <button id="submit-btn">Classify</button>
          </div>
          <div class="preview-shell">
            <img id="preview-img" alt="Selected preview" />
            <span id="preview-placeholder">Your image preview appears here.</span>
          </div>
        </section>
        <section class="card" aria-live="polite" aria-label="Prediction results">
          <div id="status">Waiting for an image...</div>
          <div id="results-panel" class="predictions" hidden></div>
        </section>
      </div>
    </main>
    <script type="module">
      import { Client, handle_file } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

      const fileInput = document.getElementById("image-input");
      const submitBtn = document.getElementById("submit-btn");
      const statusBubble = document.getElementById("status");
      const resultsPanel = document.getElementById("results-panel");
      const previewImg = document.getElementById("preview-img");
      const previewPlaceholder = document.getElementById("preview-placeholder");
      const fileMeta = document.getElementById("file-meta");
      const inlineFilename = document.getElementById("inline-filename");

      const client = await Client.connect("sebanema/renewable-energy-classifier");

      function updatePreview(file) {
        if (!file) {
          previewImg.style.display = "none";
          previewImg.removeAttribute("src");
          previewPlaceholder.hidden = false;
          fileMeta.textContent = "No file selected";
          inlineFilename.textContent = "No file selected";
          return;
        }
        previewImg.src = URL.createObjectURL(file);
        previewImg.style.display = "block";
        previewPlaceholder.hidden = true;
        fileMeta.textContent = file.name;
        inlineFilename.textContent = file.name;
      }

      function renderScores(confidences) {
        resultsPanel.innerHTML = "";

        const entries = (confidences || [])
          .map(({ label, confidence }) => ({
            label: String(label),
            score: Number(confidence ?? 0),
          }))
          .sort((a, b) => b.score - a.score);

        entries.forEach(({ label, score }) => {
          const row = document.createElement("div");
          row.className = "prediction-row";

          const labelEl = document.createElement("span");
          labelEl.textContent = label.replace(/_/g, " ");

          const barWrapper = document.createElement("div");
          const bar = document.createElement("div");
          bar.className = "bar";
          bar.style.setProperty("--fill", `${(score * 100).toFixed(1)}%`);

          const value = document.createElement("div");
          value.className = "bar-value";
          value.textContent = `${(score * 100).toFixed(1)}%`;

          barWrapper.appendChild(bar);
          const container = document.createElement("div");
          container.style.display = "flex";
          container.style.flexDirection = "column";
          container.style.gap = ".35rem";
          container.appendChild(barWrapper);
          container.appendChild(value);

          row.appendChild(labelEl);
          row.appendChild(container);
          resultsPanel.appendChild(row);
        });

        resultsPanel.hidden = entries.length === 0;
      }

      async function classify() {
        const file = fileInput.files[0];
        if (!file) {
          statusBubble.textContent = "Please choose an image first.";
          return;
        }

        submitBtn.disabled = true;
        statusBubble.textContent = "Sending image to Hugging Face Space...";

        try {
          const result = await client.predict("/predict", [handle_file(file)]);

          console.log("Raw result from Space:", result);

          const output = Array.isArray(result?.data) ? result.data[0] : result;

          const confidences = output?.confidences;
          if (!Array.isArray(confidences)) {
            console.error("Unexpected result shape:", result);
            statusBubble.textContent =
              "Unexpected API response. Check the Space logs / console.";
            resultsPanel.hidden = true;
            return;
          }

          statusBubble.textContent =
            "Inference complete. Highest confidence first.";
          renderScores(confidences);
        } catch (error) {
          console.error("Error calling Space:", error);
          statusBubble.textContent =
            "Error calling the Space. Check console / Space logs.";
          resultsPanel.hidden = true;
        } finally {
          submitBtn.disabled = false;
        }
      }

      fileInput.addEventListener("change", () => {
        updatePreview(fileInput.files[0]);
        statusBubble.textContent =
          "Ready to classify. Click the button when you're set.";
        resultsPanel.hidden = true;
      });

      submitBtn.addEventListener("click", classify);
    </script>
  </body>
</html>
